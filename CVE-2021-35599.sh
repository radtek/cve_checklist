#!/usr/bin/bash
#. ./oracle_param.ini
################################################################################
#                               CVE-2021-35599
#                                21c
# Sample script that checks the DB version and execute a check following
# by recommendation.
# Create oracle_param.ini file with defined variables
# Both script and ini required to have u+x permission
# Sample exection
# $./CVE-2021-35599.sh
#
# Change History
# 15/10/2021  Deepak Baranwal  Original code. This is a template for creating
#                              new Bash shell scripts.
#                              Add new history entries as needed.
#
#
################################################################################
################################################################################


# export ORACLE_BASE=/u01/app/oracle
# export ORACLE_HOME=/u01/app/oracle/product/18.4.0/db_1
# export ORACLE_SID=orclcdb
# export SQLPLUS_HOME=/u01/app/oracle/product/18.4.0/db_1/bin/sqlplus
# export ORACLE_HOME=$PATH:$ORACLE_HOM/bin
discover_35599(){
  ver=$(sqlplus -s / as sysdba <<EOM
        set heading OFF termout ON trimout ON feedback OFF
        set pagesize 0
        select version from v\$instance;
EOM
)
#return ${ver}
}

mitigate_35599_1(){
echo "Please review recommendation in file mitigate_35599_1.txt"
echo "
Vulnerability is specific to "local logon", i.e. connection on the same host computer where Oracle database is installed, thus harden operating system access (ssh, telnet) and SQL Command Line (or other Oracle command-line utility) which allows local connection.

Specifically for Oracle Zero Downtime Migration (ZDM) software.

Protect OS zdm group and zdmuser, and ZDM Oracle home binaries.
Ensure relevant firewall security on port 1521 which must be open for ZDM node connections to source/target databases.
Use Private SSH keys between ZDM host, and source/target database host.

When no longer in use, shut down the vulnerable service(s).

Zero Downtime Migration Software Shutdown / Uninstallation
1. Connect as user with which you want to uninstall the ZDM software on the Linux host
2. Stop the Zero Downtime Migration service
        $ <ZDM_HOME>/bin/zdmservice stop
3. Run the following command to uninstall the software.
        $ <ZDM_HOME>/bin/zdmservice stop deinstall

" >mitigate_35599_1.txt
}

### main ###

discover_35599

if [ ${ver} = '21.0.0.0.0' ]
then
   mitigate_35599_1
fi

### main ###
