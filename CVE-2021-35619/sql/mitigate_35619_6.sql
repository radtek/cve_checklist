set heading OFF termout ON trimout ON feedback OFF
set pagesize 0 linesize 180
spool mitigate_35619_6.sql
SELECT DISTINCT 'EXEC DBMS_JAVA.REVOKE_PERMISSION (''' || GRANTEE || ''',''java.io.FilePermission'', ''<<ALL FILES>>'',''execute'');' FROM DBA_JAVA_POLICY WHERE TYPE_NAME = 'java.io.FilePermission' AND ACTION LIKE '%execute%' AND (NAME='<<ALL FILES>>' OR NAME LIKE '%*%') AND KIND = 'GRANT' AND ENABLED='ENABLED' AND GRANTEE != 'JAVASYSPRIV';
SELECT DISTINCT 'EXEC DBMS_JAVA.REVOKE_PERMISSION (''' || GRANTEE || ''',''java.security.AllPermission'');' FROM DBA_JAVA_POLICY WHERE TYPE_NAME = 'java.security.AllPermission' AND KIND = 'GRANT' AND ENABLED='ENABLED' AND GRANTEE != 'SYS';
SELECT DISTINCT 'EXEC DBMS_JAVA.REVOKE_PERMISSION (''' || GRANTEE || ''',''java.io.FilePermission'', ''<<ALL FILES>>'',''write'');' FROM DBA_JAVA_POLICY WHERE TYPE_NAME = 'java.io.FilePermission' AND ACTION LIKE '%write%' AND NAME='<<ALL FILES>>' AND KIND = 'GRANT' AND ENABLED='ENABLED' AND GRANTEE != 'JAVASYSPRIV';
SELECT DISTINCT 'EXEC DBMS_JAVA.DELETE_PERMISSION(' || seq || ');' FROM DBA_JAVA_POLICY WHERE TYPE_NAME = 'java.lang.RuntimePermission' AND NAME LIKE '%loadLibrary%' AND KIND = 'GRANT' AND ENABLED='ENABLED' AND GRANTEE NOT IN ('SYS', 'ORDSYS');
SELECT 'REVOKE '||  PRIVILEGE || 'ON JAVA$POLICY$ FROM ' || GRANTEE || ';' FROM DBA_TAB_PRIVS WHERE TABLE_NAME like 'JAVA$POLICY$';
spool off
