set heading OFF termout ON trimout ON feedback OFF
set echo off
set pagesize 0 linesize 180
spool mitigate_35619_1.sql
SELECT 'REVOKE CREATE PROCEDURE FROM '|| GRANTEE ||';' FROM DBA_SYS_PRIVS WHERE PRIVILEGE = 'CREATE PROCEDURE' AND grantee IN (SELECT USERNAME FROM DBA_USERS WHERE PROFILE NOT IN ('DBS_SERVICES_PROFILE','SYSTEM_ACCOUNTS','DEFAULT','C##SYSTEM_ACCOUNTS','C##DBS_SERVICES_PROFILE'));
SELECT 'REVOKE CREATE PROCEDURE FROM '|| USERNAME ||';' from dba_users where PROFILE NOT IN ('DBS_SERVICES_PROFILE','SYSTEM_ACCOUNTS','DEFAULT','C##SYSTEM_ACCOUNTS','C##DBS_SERVICES_PROFILE') and USERNAME in (SELECT distinct GRANTEE FROM DBA_ROLE_PRIVS WHERE GRANTED_ROLE IN (SELECT ROLE FROM ROLE_SYS_PRIVS WHERE PRIVILEGE='CREATE PROCEDURE'));
spool off;

